<% layout('layouts/boilerplate') %>
  <style>
    #filters{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
    }
    .filter{
      text-align:center;
      margin-right:2rem;
      margin-top:2rem;
      opacity:0.7;
    } 
    .filter:hover{
      opacity:1;
      cursor:pointer;
    }
    .filter{
      text-decoration:none;
      color:inherit;
    }
    .filter-active{
      opacity:1;
      font-weight:bold;
      border-bottom:2px solid #fe424d;
    }
    .filter p{
      font-size:0.8rem;
    }
    .tax-info{
      display:none;
    }
    .tax-toggle{
      border:1px solid black;
      border-radius:1rem;
      height:3.25rem;
      padding:1rem;
      margin-left:5rem;
      display:flex;
      align-items:center;
    }
  </style>
<%
  const searchParam = (typeof searchQuery !== 'undefined' && searchQuery) ? '&search=' + encodeURIComponent(searchQuery) : '';
%>
<div id="filters">
<a href="/listings?category=Trending<%= searchParam %>" class="filter <%= currentCategory === 'Trending' ? 'filter-active' : '' %>">
<div><i class="fa-solid fa-fire"></i></div>
<p>Trending</p>
</a>
<a href="/listings?category=Rooms<%= searchParam %>" class="filter <%= currentCategory === 'Rooms' ? 'filter-active' : '' %>">
<div><i class="fa-solid fa-bed"></i></div>
<p>Rooms</p>
</a>
<a href="/listings?category=Iconic Cities<%= searchParam %>" class="filter <%= currentCategory === 'Iconic Cities' ? 'filter-active' : '' %>">
<div><i class="fa-solid fa-mountain-city"></i></div>
<p>Iconic Cities</p>
</a>
<a href="/listings?category=Mountains<%= searchParam %>" class="filter <%= currentCategory === 'Mountains' ? 'filter-active' : '' %>">
<div><i class="fa-solid fa-mountain"></i></div>
<p>Mountains</p>
</a>
<a href="/listings?category=Castles<%= searchParam %>" class="filter <%= currentCategory === 'Castles' ? 'filter-active' : '' %>">
<div><i class="fa-brands fa-fort-awesome"></i></div>
<p>Castles</p>
</a>
<a href="/listings?category=Amazing Pools<%= searchParam %>" class="filter <%= currentCategory === 'Amazing Pools' ? 'filter-active' : '' %>">
<div><i class="fa-solid fa-person-swimming"></i></div>
<p>Amazing Pools</p>
</a>
<a href="/listings?category=Camping<%= searchParam %>" class="filter <%= currentCategory === 'Camping' ? 'filter-active' : '' %>">
<div><i class="fa-solid fa-campground"></i></div>
<p>Camping</p>
</a>
<a href="/listings?category=Farms<%= searchParam %>" class="filter <%= currentCategory === 'Farms' ? 'filter-active' : '' %>">
<div><i class="fa-sharp fa-solid fa-cow"></i></div>
<p>Farms</p>
</a>
<a href="/listings?category=Arctic<%= searchParam %>" class="filter <%= currentCategory === 'Arctic' ? 'filter-active' : '' %>">
<div><i class="fa-duotone fa-regular fa-snowflake"></i></div>
<p>Arctic</p>
</a>
<a href="/listings?category=Domes<%= searchParam %>" class="filter <%= currentCategory === 'Domes' ? 'filter-active' : '' %>">
<div><i class="fa-sharp fa-solid fa-landmark-dome"></i></div>
<p>Domes</p>
</a>
<a href="/listings?category=Boats<%= searchParam %>" class="filter <%= currentCategory === 'Boats' ? 'filter-active' : '' %>">
<div><i class="fa-solid fa-ship"></i></div>
<p>Boats</p>
</a>
<div class="tax-toggle">
  <div class="form-check-reverse form-switch">
  <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault">
  <label class="form-check-label" for="switchCheckDefault">Display total after taxes</label>
</div>
</div>
</div>
   <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-3 g-3 mt-3">

     <% if (allListings.length === 0) { %>
       <div class="col-12 text-center py-5">
         <p class="text-muted"><%= (typeof searchQuery !== 'undefined' && searchQuery) ? 'No listings match your search.' : 'No listings in this category yet.' %></p>
         <a href="/listings" class="btn btn-outline-primary">View all (Trending)</a>
       </div>
     <% } %>
     <% for(let listing of allListings) { %>
      <a href="/listings/<%=listing._id%>" class="listing-link">
    <div class="card col listing-card">
  <img src="<%=listing.image.url%>" class="card-img-top" alt="listing_image" style="height: 20rem">
  <div class="card-img-overlay"></div>
  <div class="card-body">
    <p class="card-text">
     <b> <%=listing.title %> </b><br>
      &#8377;<%=listing.price.toLocaleString("en-IN") %>/night
      <i class="tax-info"> &nbsp; &nbsp; +18% GST</i>
    </p>
  </div>
</div>
      </a>
 <% } %>
</div>

<script>
  const switchCheckDefault = document.getElementById("switchCheckDefault");
  switchCheckDefault.addEventListener("click", () => {
   let taxInfo = document.getElementsByClassName("tax-info");
   for(info of taxInfo){
    if(info.style.display != "inline"){
      info.style.display = "inline";
    }else{
      info.style.display = "none";
    }
   }
  });
</script>