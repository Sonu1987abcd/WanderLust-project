<% layout('layouts/boilerplate') %>
<div class="row mt-3">
    <h1 class="col-6 offset-3">Change Password</h1>
    <div class="col-6 offset-3">
        <p class="text-muted">Enter your current password and choose a new password.</p>
        <form action="/change-password" method="POST" class="needs-validation" novalidate>
            <div class="mb-3">
                <label for="currentPassword" class="form-label">Current Password</label>
                <div class="input-group">
                    <input name="currentPassword" id="currentPassword" placeholder="Enter current password" type="password" class="form-control" required minlength="6"/>
                    <button type="button" class="btn btn-outline-secondary toggle-pwd" data-target="currentPassword" title="Show password" aria-label="Show password">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
                <div class="invalid-feedback">Please enter your current password.</div>
            </div>
            <div class="mb-3">
                <label for="newPassword" class="form-label">New Password</label>
                <div class="input-group">
                    <input name="newPassword" id="newPassword" placeholder="Enter new password (min 6 characters)" type="password" class="form-control" required minlength="6"/>
                    <button type="button" class="btn btn-outline-secondary toggle-pwd" data-target="newPassword" title="Show password" aria-label="Show password">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
                <div class="invalid-feedback">Password must be at least 6 characters.</div>
            </div>
            <div class="mb-3">
                <label for="confirmPassword" class="form-label">Confirm New Password</label>
                <div class="input-group">
                    <input name="confirmPassword" id="confirmPassword" placeholder="Confirm new password" type="password" class="form-control" required minlength="6"/>
                    <button type="button" class="btn btn-outline-secondary toggle-pwd" data-target="confirmPassword" title="Show password" aria-label="Show password">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
                <div class="invalid-feedback">Please confirm your new password.</div>
            </div>
            <button type="submit" class="btn btn-success">Change Password</button>
            <a href="/listings" class="btn btn-outline-secondary ms-2">Cancel</a>
        </form>
    </div>
</div>

<script>
document.querySelectorAll('.toggle-pwd').forEach(function(btn) {
    btn.addEventListener('click', function() {
        var id = this.getAttribute('data-target');
        var input = document.getElementById(id);
        var icon = this.querySelector('i');
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.replace('fa-eye', 'fa-eye-slash');
            this.setAttribute('title', 'Hide password');
        } else {
            input.type = 'password';
            icon.classList.replace('fa-eye-slash', 'fa-eye');
            this.setAttribute('title', 'Show password');
        }
    });
});
document.querySelector('form').addEventListener('submit', function(e) {
    const newP = document.getElementById('newPassword').value;
    const confirmP = document.getElementById('confirmPassword').value;
    if (newP !== confirmP) {
        e.preventDefault();
        alert('New password and confirm password do not match.');
        return false;
    }
    if (newP.length < 6) {
        e.preventDefault();
        alert('New password must be at least 6 characters long.');
        return false;
    }
});
</script>
